  o Code simplification and refactoring:
    - Refactor main loop to extract the 'loop' part.  This makes it easier
      to run Tor under Shadow. Closes ticket 15176.
